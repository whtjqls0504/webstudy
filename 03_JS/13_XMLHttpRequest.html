<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    /*
      비동기(Asynchronous) 처리 방식
      1. 통신(송수신, 요청과 응답)을 할때 사용하는 방식이다.
      2.  요청과 응답이 순서대로 진행되는 "동기(Sywnchronous)" 처리 방식이 있고,
          요청과 응답이 순서없이 진행되는 "비동기(Asyschronous)" 처리 방식이 있다.
      3. 비동기 처리 방식은 요청에 대한 응답이 없어도 계속 요청할 수 있다.
      4. 응답을 기다리는 시간이 없기 때문에 빠른 통신 방식이다.
      5. 순서대로 처리해야 하는 서비스의 경우 문제가 발생할 수 있다.

    */
  </script>

  <div class="wrap1">
    <input type="button" value="XML요청1" id="btn_xml_request1">
    <div id="xml_response1"></div>
  </div>
  <script>
    document.getElementById('btn_xml_request1').addEventListener('click', function(){
      // 1. XMLHttpRequest 객체 생성 (비동기 통신을 수행하는 객체)
      var xhr = new XMLHttpRequest();

      // 2. 요청 정보 생성
      //      1) 형식 : xhr.open(HttpMethod, URL, Sync/Async);
      //      2) RequestMethod : get 또는 post
      //      3) URL : 요청 URL(서버 경로 작성)
      xhr.open('get', 'book1.xml', true);

      // 3. 요청 
      xhr.send();
      
      // 4. 응답
      //    1) xhr 객체의 readystatechange 이벤트 : 응답되었는지 확인하는 이벤트
      //    2) xhr.status   : 응답코드 (200:성공, 4XX: 클라이언트 측 오류, )
      //    3) xhr.readyState   : 통신상태(0:OPENED, 1:UNSEND, 2:HEADER_RECEIVE, 3:LOADING, 4:DONE)
      //    4) 응답 데이터 형식에 따른 속성(property)
      //       (1) XML  : responseXML
      //       (2) JSON : responseText


      xhr.addEventListener('readystatechange', function(){
        // alert('응답코드 ' + xhr.status);
        // alert('통신상태 ' + xhr.readyState);
        // if(xhr.readyState == 4 && xhr.status === 200){
        // document.getElementById('xml1.response1').textContent= xhr.responseXML;
        if(xhr.readyState === 4){
          if(xhr.status === 200){
            var data = xhr.responseXML;
            var str ='';
            var title = data.getElementsByTagName('title');
            var author = data.getElementsByTagName('author');
            for(let i=0; i<title.length; i++){
              str += ''
              str += '<li>' + title[i].textContent + '</li>';
              str += '<li>' + author[i].textContent + '</li>';
              str += '<li>';
            }
            document.getElementById('xml_response1').textContent = str;
          }
        }  

      })
    })

  </script>
  <hr>
  <div class="wrap2">
    <input type="button" value="XML요청2" id="btn_xml_requet2">
    <div id="xml_response2"></div>
  </div>
  <script>

    document.getElementById('btn_xml_request2').addEventListener('click', function(){
      var xhr = new XMLHttpRequest();
      xhr.open('get', 'book2.xml', true);
      xhr.send();
      xhr.addEventListener('readystatechange', function(){
        if(xhr.readyState === 4){
          if(xhr.status === 200){
            var data = xhr.responseXML;
            var book = data.getElementsByTagName('book');
            var str = '';
            for(let i =0; i< book.length; i++){
              str += '<ul>';
              str += '<li>' + book[i].getAttribute('title') + '</li>';
              str += '</ul>';
            }
            document.getElementById('xml_response2').innerHTML = str;
          }
        }
      })

    }) 
  </script>
    <hr>
    <div class="wrap3">
      <input type="button" value="JSON요청1" id="btn_json_requet1">
      <div id="xml_response2"></div>
    </div>

    <script>
      document.getElementById('btn_json_requet1').addEventListener('click', function(){
          var xhr = new XMLHttpRequest();
          xhr.open('get', 'book1.json', true);
          xhr.send();
          xhr.addEventListener('readystatechange', function(){
            if(xhr.readyState === 4){
              if(xhr.status === 200){
                var data = xhr.responseText;
                console.log(data);
          }
        }
      })
    })
    </script>


    <hr>
    <div class="wrap4">
      <input type="button" value="JSON요청2" id="btn_json_requet2">
      <div id="xml_response2"></div>
    </div>


  
</body>
</html>